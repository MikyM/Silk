@page "/"
@namespace Silk.Dashboard.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@using Silk.Extensions
@using Silk.Dashboard.Extensions
@using Silk.Dashboard.Services.DiscordTokenStorage
@using Silk.Dashboard.Services.DiscordTokenStorage.Interfaces

@{
    Layout = "_Layout";

    var userId = HttpContext.User.GetUserId();

    if (!string.IsNullOrEmpty(userId))
    {
        var tokenStorage = HttpContext.RequestServices.Get<IDiscordTokenStore>();
        var token = await DiscordTokenStoreEntry.FromHttpContext(HttpContext);
        tokenStorage!.SetToken(userId, token);
    }
}

<component type="@typeof(App)" render-mode="Server" />
